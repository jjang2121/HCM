<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hcm.grw.model.mapper.sm.ScbDaoImpl">

<!-- 일정조회 -->
<select id="getAllCalendar" resultType="ScbDto">

SELECT *
FROM (
		SELECT SCBO_NO, SCBO_EMPNO, SCBO_TITLE, SCBO_CONTENT,SCBO_WRITER,
		SCBO_DELFLAG, SCBO_START, SCBO_END, TO_CHAR(SCBO_CGORY_NO) AS SCBO_CGORY_NO ,  4 AS TYPE
			FROM SCHEDULE_BOARD sb
			WHERE SCBO_EMPNO = #{scbo_empno}
			AND SCBO_CGORY_NO = '200' AND SCBO_DELFLAG = 'N' 
		    AND (TO_CHAR(SCBO_START, 'YYYY-MM') = #{daygridmonth}
		    OR TO_CHAR(SCBO_END, 'YYYY-MM') = #{daygridmonth})
		UNION ALL
		SELECT SIDB_DOC_NUM AS , EMPL_ID, SIDB_DOC_TITLE, SIDB_DOC_CONTENT,(SELECT EMPL_NAME FROM EMPLOYEE WHERE EMPL_ID = #{scbo_empno}),
		SIDB_DOC_FLAG, SIDB_DOC_BE, SIDB_DOC_END, SIDT_TEMP_CD ,  1 AS TYPE
			FROM ADMIN.SIGN_DOC_BOX SDB1
			WHERE EMPL_ID IN(
			SELECT EMPL_ID 
				FROM EMPLOYEE
				WHERE EMPL_DEPT_CD = (
					SELECT EMPL_DEPT_CD 
						FROM EMPLOYEE
						WHERE EMPL_ID = #{scbo_empno}
			)	
			) 
			AND SIDB_DOC_FLAG = '1' AND SIDT_TEMP_CD = 'TC000002'
		    AND (TO_CHAR(SIDB_DOC_BE, 'YYYY-MM') = #{daygridmonth}
		    OR TO_CHAR(SIDB_DOC_END, 'YYYY-MM') = #{daygridmonth}) 
		UNION ALL    
		SELECT SIDB_DOC_NUM, EMPL_ID, SIDB_DOC_TITLE, SIDB_DOC_CONTENT,(SELECT EMPL_NAME FROM EMPLOYEE WHERE EMPL_ID = #{scbo_empno}),
		SIDB_DOC_FLAG, SIDB_DOC_BE, SIDB_DOC_END, SIDT_TEMP_CD ,  2 AS TYPE
			FROM ADMIN.SIGN_DOC_BOX SDB2
			WHERE EMPL_ID IN(
			SELECT EMPL_ID 
				FROM EMPLOYEE
				WHERE EMPL_DEPT_CD = (
					SELECT EMPL_DEPT_CD 
						FROM EMPLOYEE
						WHERE EMPL_ID = #{scbo_empno}
			)	
			)
			AND SIDB_DOC_FLAG = '1'	AND SIDT_TEMP_CD = 'TC000001'
			AND (TO_CHAR(SIDB_DOC_BE, 'YYYY-MM') = #{daygridmonth}
			OR TO_CHAR(SIDB_DOC_END, 'YYYY-MM') = #{daygridmonth}) 
		UNION ALL
		SELECT SCBO_NO, SCBO_EMPNO, SCBO_TITLE, SCBO_CONTENT,SCBO_WRITER,
		SCBO_DELFLAG, SCBO_START, SCBO_END, TO_CHAR(SCBO_CGORY_NO) AS SCBO_CGORY_NO ,  3 AS TYPE
			FROM SCHEDULE_BOARD sb
			WHERE SCBO_EMPNO = #{scbo_empno}
			AND SCBO_CGORY_NO = '100' AND SCBO_DELFLAG = 'N'
		    AND (TO_CHAR(SCBO_START, 'YYYY-MM') = #{daygridmonth}
		    OR TO_CHAR(SCBO_END, 'YYYY-MM') = #{daygridmonth})  
		)
		WHERE TYPE IN(
						<foreach collection="type" item="type1" separator=",">
								#{type1}
							</foreach>
						)
</select>


<select id="detailScbo" resultType="ScbDto">
SELECT *
FROM (
		SELECT SCBO_NO, SCBO_EMPNO, SCBO_TITLE,SCBO_CONTENT, SCBO_WRITER,
		SCBO_DELFLAG, SCBO_START, SCBO_END, TO_CHAR(SCBO_CGORY_NO) AS SCBO_CGORY_NO ,  4 AS TYPE
			FROM SCHEDULE_BOARD sb
			WHERE SCBO_EMPNO IN (
			SELECT EMPL_ID 
				FROM EMPLOYEE
				WHERE EMPL_DEPT_CD = (
					SELECT EMPL_DEPT_CD 
						FROM EMPLOYEE
						WHERE EMPL_ID = #{scbo_empno}
			)	
			) 
			AND SCBO_CGORY_NO = '200'
		UNION ALL
		SELECT SIDB_DOC_NUM AS , EMPL_ID, SIDB_DOC_TITLE, SIDB_DOC_CONTENT,(SELECT EMPL_NAME FROM EMPLOYEE WHERE EMPL_ID = #{scbo_empno}),
		SIDB_DOC_FLAG, SIDB_DOC_BE, SIDB_DOC_END, SIDT_TEMP_CD ,  1 AS TYPE
			FROM ADMIN.SIGN_DOC_BOX SDB1
			WHERE EMPL_ID IN (
			SELECT EMPL_ID 
				FROM EMPLOYEE
				WHERE EMPL_DEPT_CD = (
					SELECT EMPL_DEPT_CD 
						FROM EMPLOYEE
						WHERE EMPL_ID = #{scbo_empno}
			)	
			)  
			AND SIDB_DOC_FLAG = '1' AND SIDT_TEMP_CD = 'TC000002'
		UNION ALL    
		SELECT SIDB_DOC_NUM, EMPL_ID, SIDB_DOC_TITLE, SIDB_DOC_CONTENT,(SELECT EMPL_NAME FROM EMPLOYEE WHERE EMPL_ID = #{scbo_empno}),
		SIDB_DOC_FLAG, SIDB_DOC_BE, SIDB_DOC_END, SIDT_TEMP_CD ,  2 AS TYPE
			FROM ADMIN.SIGN_DOC_BOX SDB2
			WHERE EMPL_ID IN (
			SELECT EMPL_ID 
				FROM EMPLOYEE
				WHERE EMPL_DEPT_CD = (
					SELECT EMPL_DEPT_CD 
						FROM EMPLOYEE
						WHERE EMPL_ID = #{scbo_empno}
			)	
			)  
			AND SIDB_DOC_FLAG = '1'	AND SIDT_TEMP_CD = 'TC000001'
		UNION ALL
		SELECT SCBO_NO, SCBO_EMPNO, SCBO_TITLE, SCBO_CONTENT,SCBO_WRITER,
		SCBO_DELFLAG, SCBO_START, SCBO_END, TO_CHAR(SCBO_CGORY_NO) AS SCBO_CGORY_NO ,  3 AS TYPE
			FROM SCHEDULE_BOARD sb
			WHERE SCBO_EMPNO IN (
			SELECT EMPL_ID 
				FROM EMPLOYEE
				WHERE EMPL_DEPT_CD = (
					SELECT EMPL_DEPT_CD 
						FROM EMPLOYEE
						WHERE EMPL_ID = #{scbo_empno}
			)	
			)  
			AND SCBO_CGORY_NO = '100'
			)
			WHERE SCBO_NO = #{scbo_no}
</select>

<!-- 일정등록 -->
<insert id="insertScbo">
INSERT INTO ADMIN.SCHEDULE_BOARD
(SCBO_NO, SCBO_CGORY_NO, SCBO_EMPNO, SCBO_WRITER, 
SCBO_TITLE, SCBO_CONTENT, SCBO_REGDATE, SCBO_START, 
SCBO_END, SCBO_MODIFY_ID, SCBO_MODIFY_DATE, SCBO_BIGO, 
SCBO_DELFLAG)
VALUES((SELECT NVL(MAX(SCBO_NO)+1,0) FROM SCHEDULE_BOARD), #{scbo_cgory_no}, #{scbo_empno}, #{scbo_writer}, 
#{scbo_title}, #{scbo_content}, CURRENT_TIMESTAMP , #{scbo_start}, 
#{scbo_end}, #{scbo_modify_id}, SYSDATE , #{scbo_bigo}, 'N' )
</insert>

<!-- 일정 수정 -->
<update id="updateScbo">
UPDATE ADMIN.SCHEDULE_BOARD
SET  SCBO_CGORY_NO= #{scbo_cgory_no}, SCBO_TITLE = #{scbo_title}, SCBO_CONTENT = #{scbo_content}, SCBO_START = #{scbo_start},
SCBO_END = #{scbo_end},SCBO_BIGO = #{scbo_bigo},SCBO_MODIFY_ID= #{scbo_modify_id} , SCBO_MODIFY_DATE = CURRENT_TIMESTAMP
WHERE SCBO_NO = #{scbo_no}
</update>



<!-- 일정 삭제 -->
<update id="updateScboDelFlag">
UPDATE ADMIN.SCHEDULE_BOARD
SET SCBO_DELFLAG = 'Y',SCBO_MODIFY_ID=#{scbo_modify_id}, SCBO_MODIFY_DATE = CURRENT_TIMESTAMP 
WHERE SCBO_NO = #{scbo_no}
</update>


</mapper>
